@use '../../styles/tokens' as *;

// ============================================
// Map View Container
// ============================================

.map-view-container {
  width: 100%;
  height: 100%;
  position: relative;

  .leaflet-map {
    width: 100%;
    height: 100%;
    min-height: 500px;
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-01);
  }
}

// ============================================
// Custom Marker Icons
// ============================================

.custom-marker {
  background: transparent;
  border: none;

  .marker-icon {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50% 50% 50% 0;
    transform: rotate(-45deg);
    box-shadow: var(--shadow-02);
    transition: all var(--duration-fast-02) var(--easing-standard);

    svg {
      transform: rotate(45deg);
      width: 20px;
      height: 20px;
    }

    &:hover {
      transform: rotate(-45deg) scale(1.1);
      box-shadow: var(--shadow-03);
    }
  }
}

// Property markers (red/brand color)
.property-marker {
  .marker-icon {
    background: var(--interactive-primary);
    color: var(--text-on-color);
  }
}

// Vehicle markers (blue)
.vehicle-marker {
  .marker-icon {
    background: var(--color-brand-blue-60);
    color: var(--text-on-color);
  }
}

// Dark theme adjustments for vehicle markers
:root[data-carbon-theme="g90"],
:root[data-carbon-theme="g100"] {
  .vehicle-marker .marker-icon {
    background: var(--color-brand-blue-50);
  }
}

// ============================================
// Marker Clusters
// ============================================

.marker-cluster {
  border-radius: 50%;
  color: var(--text-on-color);
  font-weight: var(--font-weight-semibold);
  box-shadow: var(--shadow-02);
  transition: all var(--duration-fast-02) var(--easing-standard);

  &:hover {
    transform: scale(1.1);
    box-shadow: var(--shadow-03);
  }

  div {
    background: transparent;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-on-color);
    border-radius: 50%;
  }
  
  span {
    color: var(--text-on-color);
    font-size: inherit;
    font-weight: var(--font-weight-semibold);
  }
}

// Property clusters (red)
.marker-cluster-property {
  background: var(--interactive-primary);
  border: 2px solid var(--interactive-primary);
  
  div {
    background: var(--interactive-primary);
  }
}

// Vehicle clusters (blue)
.marker-cluster-vehicle {
  background: var(--color-brand-blue-60);
  border: 2px solid var(--color-brand-blue-60);
  
  div {
    background: var(--color-brand-blue-60);
  }
}

// Dark theme adjustments for vehicle clusters
:root[data-carbon-theme="g90"],
:root[data-carbon-theme="g100"] {
  .marker-cluster-vehicle {
    background: var(--color-brand-blue-50);
    border-color: var(--color-brand-blue-50);
    
    div {
      background: var(--color-brand-blue-50);
    }
  }
}

.marker-cluster-small {
  width: 40px;
  height: 40px;
  font-size: var(--font-size-sm);
}

.marker-cluster-medium {
  width: 50px;
  height: 50px;
  font-size: var(--font-size-md);
}

.marker-cluster-large {
  width: 60px;
  height: 60px;
  font-size: var(--font-size-lg);
}

// ============================================
// Spiderfy Lines (Cluster Expansion Lines)
// ============================================

// Make spiderfy lines match cluster color
.leaflet-cluster-spider-leg {
  stroke-opacity: 0.5;
  stroke-width: 1.5;
  
  // Default stroke (for mixed or unknown)
  stroke: var(--interactive-primary);
}

// ============================================
// Fix for Spiderfied Markers
// ============================================

// Ensure custom markers display correctly during spiderfy animation
.leaflet-marker-icon.custom-marker {
  // Force custom icon display
  opacity: 1 !important;
  visibility: visible !important;
  
  // Prevent default marker from showing
  background-image: none !important;
}

// Hide default Leaflet marker icon when custom icons are present
.leaflet-marker-pane {
  // Only show custom markers, hide defaults
  .leaflet-marker-icon:not(.custom-marker):not(.marker-cluster) {
    display: none !important;
  }
}

// Ensure spiderfied custom markers are visible
.leaflet-marker-pane .custom-marker {
  display: block !important;
  opacity: 1 !important;
}

// ============================================
// Custom Popups
// ============================================

.leaflet-popup-content-wrapper {
  background: var(--background-primary) !important;
  border: 1px solid var(--border-subtle) !important;
  border-radius: var(--radius-md) !important;
  box-shadow: var(--shadow-03) !important;
  padding: 0 !important;
  overflow: hidden !important;
}

.leaflet-popup-content {
  margin: 0 !important;
  width: 280px !important;
  max-width: 280px !important;
  font-family: var(--font-family-sans) !important;
}

.leaflet-popup-tip {
  background: var(--background-primary) !important;
  border: 1px solid var(--border-subtle) !important;
  border-top: none !important;
  border-right: none !important;
}

.popup-content {
  padding: var(--spacing-05);

  .popup-title {
    margin: 0 0 var(--spacing-03) 0;
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    color: var(--text-primary);
    line-height: var(--line-height-heading);
  }

  .popup-address {
    margin: 0 0 var(--spacing-04) 0;
    font-size: var(--font-size-sm);
    color: var(--text-secondary);
    line-height: var(--line-height-body);
  }

  .popup-details {
    margin-bottom: var(--spacing-04);
    padding: var(--spacing-04) 0;
    border-top: 1px solid var(--border-subtle);
    border-bottom: 1px solid var(--border-subtle);
  }

  .popup-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-03);
    gap: var(--spacing-03);

    &:last-child {
      margin-bottom: 0;
    }
  }

  .popup-label {
    font-size: var(--font-size-sm);
    color: var(--text-secondary);
    font-weight: var(--font-weight-regular);
  }

  .popup-value {
    font-size: var(--font-size-sm);
    color: var(--text-primary);
    font-weight: var(--font-weight-semibold);
    text-align: right;
  }

  .popup-premium {
    color: var(--interactive-primary);
  }

  .popup-claims {
    color: var(--color-support-error);
  }

  .popup-button {
    width: 100%;
    max-width: 100%;
    justify-content: center;
  }
}

// Close button styling
.leaflet-popup-close-button {
  color: var(--text-secondary) !important;
  font-size: 24px !important;
  padding: 4px 8px !important;
  
  &:hover {
    color: var(--text-primary) !important;
    background: var(--background-hover) !important;
  }
}

// ============================================
// Responsive
// ============================================

@media (max-width: 672px) {
  .map-view-container {
    .leaflet-map {
      min-height: 400px;
      border-radius: var(--radius-md);
    }
  }

  .leaflet-popup-content {
    width: 240px !important;
    max-width: 240px !important;
  }

  .popup-content {
    padding: var(--spacing-04);

    .popup-title {
      font-size: var(--font-size-md);
    }

    .popup-row {
      flex-direction: column;
      align-items: flex-start;
      gap: var(--spacing-02);
    }

    .popup-value {
      text-align: left;
    }
  }
}
